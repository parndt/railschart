<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="out.js"></script>
    <script type="text/javascript">
      function drawChart() {
        var builds = travisdata();
        var masterBuilds = builds.filter(function(build) {
          return build.branch == "master";
        });
        var passed = masterBuilds.filter(function(build) {
          return build.matrix.every(function(m) {
            return m.status == 0;
          });
        }).sort(function(l, r) {
          return parseInt(l.number) - parseInt(r.number);
        });
        all(passed);
      }

      function all(builds) {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Build');

        // Add the columns
        builds[0].matrix.forEach(function(matrix) {
          data.addColumn('number', matrix.config.env);
        });

        builds.forEach(function(build) {
          var times = build.matrix.map(function(matrix) {
            var start  = Date.parse(matrix.started_at);
            var finish = Date.parse(matrix.finished_at);
            return (finish - start) / 1000;
          });
          times.unshift(build.number);
          data.addRow(times);
        });

        // Set chart options
        var options = chartOptions(
            'Test Time for master on TravisCI');

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.LineChart(document.getElementById('all'));
        chart.draw(data, options);
      }

      function chartOptions(title) {
        return { 'title': title,
                 'width':900,
                 'height':300,
                 'legend': { 'position': 'bottom' },
                 'hAxis': { 'title': 'Build ID' },
                 'vAxis': { 'title': 'Seconds' } };
      }

      google.load('visualization', '1.0', {'packages':['corechart']});
      google.load("jquery", "1.7.1");
      google.setOnLoadCallback(drawChart);
    </script>
  </head>
  <body>
    <a href="http://github.com/tenderlove/railschart">Generated by this thing</a>
    <div id="all"></div>
    <div id="railties"></div>
    <div id="ap_am_amo_ares_as"></div>
    <div id="ar_sqlite3"></div>
    <div id="ar_mysql2"></div>
    <div id="ar_mysql"></div>
    <div id="ar_postgresql"></div>
  </body>
</html>
